# CVE-2021-26334

## Description

The `AMDPowerProfiler.sys` kernel driver distributed with the AMD μProf application
expose an IOCTL functionality that allows low-privilege users to read and write
arbitrary Model Specific Registers (MSRs). This could lead to arbitrary Ring-0
code execution and escalation of privileges.

## Impact

High - Arbitrary Ring-0 code execution

## Exploitability

Medium/Low - Driver must be loaded prior to the exploitation in order to be
utilized by low-privilege users, otherwise the attacker will require admin
rights for the driver installation.

## Technical Details

The driver offers a `rdmsr` and `wrmsr` functionality exposed via IOCTL that
allows an unprivileged usermode program to read and write arbitrary CPU MSR.
This can be leveraged by the attackers to patch the critical MSRs like
`IA32_LSTAR` (`0xC0000082`) or `IA32_SYSENTER_EIP` (`0x00000176`) in order to
achieve kernel code execution. Although many kernel exploit mitigation
techniques exist, this is a viable exploit even on the newest Windows 10
systems (as of August 2020). The vulnerable IOCTLs:

    IOCTL_ACCESS_MSR  = 0x222030

## Resolution

The fix is distributed as a part of the AMD's November Patch Tuesday.

## Reporter

This vulnerability was discovered and reported by Michal Poslušný.

## Disclosure Timeline

- 3 May 2021  		- Issue reported to vendor
- 5 May 2021  		- Vendor responded and confirmed to investigate the issues
- 9 August 2021  	- Vendor shared a test version of the driver with 
					  the issues addressed
- 9 November 2021 	- Vendor released the fix and CVE as a part of the 
					  November Patch Tuesday

## References

- https://www.amd.com/en/corporate/product-security/bulletin/amd-sb-1016
